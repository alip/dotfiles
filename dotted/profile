#export BRAID_USE_LOCAL_CACHE=yes

export PATH=/usr/local/mysql/bin:$PATH
export PATH=/opt/local/bin:/opt/local/sbin:/usr/local/bin:$PATH

export PATH=~/work/gems/braid/bin:$PATH
export PATH=~/work/sdk/air/bin:$PATH
export PATH=~/.gems/bin:$PATH
export PATH=~/bin:$PATH
export PATH=~/bin/chelu/ws:$PATH
export PATH=~/bin/chelu:$PATH
export PATH=~/src/s3sync:$PATH

export PATH=~/work/checkouts/one_inch_punch/bin:$PATH
export PATH=~/work/projects/braid/bin:$PATH
export PATH=~/dotfiles:$PATH

export CLASSPATH="/Users/chelu/classpath:/Users/chelu/classpath/js.jar:$CLASSPATH"

export MANPATH=~/man:$MANPATH
export SUDOLESS=true
export MERB_SUDO=

# in case git colors fuck up
#export LESS="-erX"

. ~/bin/aliases

# don't use gems as root
#alias gemi='gem install --no-rdoc --no-ri -y'
#alias gemi='gem install -y'
export GEM_HOME="$HOME/.gems" 
export GEM_PATH="$GEM_HOME" 

export DISPLAY=:0.0
export EDITOR=g
export GIT_EDITOR=gw
export PAGER=less
export VIM_APP_DIR=/Applications
export INPUTRC=~/.inputrc

export HISTSIZE=1000000
shopt -s histappend

# have git-svn working with just port install git-core, without +svn
export PERL5LIB=/usr/local/svn/perl:/usr/local/svn/perl/darwin-thread-multi-2level

# completion
complete -C ~/.bash_completion.d/rake-complete.rb -o default rake
source ~/.bash_completion.d/git-completion.bash

function git_current_branch {
  git branch 2>/dev/null | awk '/^\* /{print $2 }'
}
function git_dirty {
  git st 2> /dev/null | grep -c : | awk '{if ($1 > 0) print "*"}'
}
function git_formatted_current_branch_with_dirty {
  if [ -n "$(git_current_branch)" ]; then
    echo " ($(git_current_branch)$(git_dirty))"
  fi
  #awk '{if ($(git_current_branch)) print " (" $(git_current_branch)$(git_dirty) ")"}'
}
function dollar_or_pound {
  if [ $(whoami) == "root" ]; then
    echo "#"
  else
    echo "$"
  fi
}
# bleh, el ugly :/
function git_status {
  if [ -n "$(git status 2>/dev/null)" ]; then
    #echo "$(git status 2>/dev/null)"
    echo "["
  else
    echo "["
  fi
}
export PS1="\$(git_status)\u@\h \w\$(git_formatted_current_branch_with_dirty)]\$(dollar_or_pound) "

#export PROMPT_COMMAND='echo -ne "\033]0;${USER}@${HOSTNAME%%.*}:${PWD/#$HOME/~} `git-branch 2>&1 | grep "*" | awk -F" " "{print $2}"`"; echo -ne "\007"' 
#Update
#If you have git bash_completion installed, you can modify your PROMPT_COMMAND to this:
#export PROMPT_COMMAND='echo -ne "\033]0;${PWD/#$HOME/~} $(__git_ps1 " (%s)")"; echo -ne "\007"'


# TODO move these to some other file
gemdoc() {
  local gemdir=`gem env gemdir`
  open $gemdir/doc/`ls $gemdir/doc/ | grep $1 | sort | tail -1`/rdoc/index.html
}
gemcd() {
  local gemdir=`gem env gemdir`
  cd $gemdir/gems/$1
}

_gemsomplete() {
  COMPREPLY=($(compgen -W '$(ls `gem env gemdir`/doc)' -- ${COMP_WORDS[COMP_CWORD]}))
  return 0
}

complete -o default -o nospace -F _gemsomplete gemdoc
complete -o default -o nospace -F _gemsomplete gemcd

